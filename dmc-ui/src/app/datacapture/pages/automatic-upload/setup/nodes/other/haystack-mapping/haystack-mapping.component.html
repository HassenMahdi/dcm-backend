

  <div class="flex column h-100 w-100 stretch">
    <p class="mb-2" nz-typography [(nzContent)]="data.label" nzEditable></p>

    <div class="mb-2 button-spacing">
        <button nz-button nz-dropdown [nzDropdownMenu]="headerMenu">
            <i nz-icon nzType="plus-square" nzTheme="twotone"></i>Add Header<i nz-icon nzType="down"></i>
        </button>
        <button nz-button nz-dropdown [nzDropdownMenu]="tagMenu" (nzVisibleChange)="onTagMenuVisibleChange($event)">
            <i nz-icon nzType="tags" nzTheme="twotone"></i>Add Tag<i nz-icon nzType="down"></i>
        </button>
    </div>
    <div class="fill mb-2 h-100 w-100">

        <div class="flex w-100 h-100">
            <div class="flex column h-100 w-25">
                <h5>Source</h5>
                <div class="flex-scroll w-100 h-100 border p-1">
                    <app-draggable-shelf [items]="sourceHeaders"  (dragStart)="highlightDropZone=true" (dragEnd)="highlightDropZone=false"></app-draggable-shelf>
                </div>

            </div>

            <div class="flex column h-100 w-75">
                <h5>Tags</h5>
                <div class="flex-scroll w-100 h-100 border p-1">
                    <div *ngFor="let t of targetTags; let i = index" class="p-2 border-bottom" dndDropzone (dndDrop)="Map($event.data, t)">
                        <div class="flex">
                            <div class="flex-1">{{t|json}}</div>
                            <button class="ghost" nz-button (click)="Untag(i)"><i nz-icon nzType="delete"></i></button>
                        </div>
                    </div>
                </div>

            </div>
            
        </div>

    </div>


    <div class="button-spacing text-right w-100">  
        <button nz-button (click)='cancel()'>Cancel</button>
        <button nz-button nzType='primary' (click)='save()'>Save</button>
    </div>
</div>



<nz-dropdown-menu #tagMenu="nzDropdownMenu">
    <div nz-menu style="max-height: 70vh;overflow: auto;">
        <!-- Search -->
        <div class="m-2">
            <nz-input-group [nzSuffix]="suffixIconSearch"><input [(ngModel)]="tagSearch" (ngModelChange)="filterTags()" type="text" nz-input placeholder="Tag Search"/></nz-input-group>
            <ng-template #suffixIconSearch><i nz-icon nzType="search"></i></ng-template>
        </div>
        <!-- List -->
        <ul>
            <li (click)="AddTag(t)" *ngFor="let t of TAGS | async" nz-menu-item>
                <span nzTooltipTitle="{{t.doc}}" nz-tooltip>
                    <span>{{t.def.val}}</span>
                </span>
            </li>
        </ul>
    </div>
  </nz-dropdown-menu>

<nz-dropdown-menu #headerMenu="nzDropdownMenu">
    <div nz-menu>
        <!-- Search -->
        <div class="m-2">
            <input type="text" nz-input placeholder="Header Name" [(ngModel)]='addedHeader'/>
        </div>
        <!-- List -->
        <ul  >
            <li nz-menu-item (click)="AddHeader()"><i nz-icon nzType="plus"></i>Add Header</li>
            <li nz-menu-item *ngFor='let h of sourceHeaders; let i= index' (click)="RemoveHeader(i)"><i nz-icon nzType="delete"></i>{{h}}</li>
        </ul>

    </div>
  </nz-dropdown-menu>